<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Sistema de Biblioteca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>.hero-section{background:#f8f9fa;padding:40px 0}.user-info{color:#f8f9fa;padding:0 8px}</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Sistema de Biblioteca</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item" sec:authorize="hasAuthority('ROLE_ADMIN')"><a class="nav-link" href="/usuarios">Usuarios</a></li>
                    <li class="nav-item"><a class="nav-link" href="/libros">Libros</a></li>
                    <li class="nav-item"><a class="nav-link" href="/prestamos">Préstamos</a></li>
                    <li class="nav-item" sec:authorize="hasAuthority('ROLE_ADMIN')"><a class="nav-link" href="/consulta-usuarios">Consulta Usuarios</a></li>
                    <li class="nav-item"><span class="user-info">Usuario: <span sec:authentication="name">Usuario</span> <span sec:authorize="hasAuthority('ROLE_ADMIN')">(ADMIN)</span><span sec:authorize="hasAuthority('ROLE_CLIENTE')">(CLIENTE)</span></span></li>
                    <li class="nav-item"><form th:action="@{/logout}" method="post" style="display:inline"><button type="submit" class="btn btn-outline-light btn-sm ms-2">Salir</button></form></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 mb-4">Sistema de Gestión de Biblioteca</h1>
            <p class="lead mb-4">Gestiona usuarios, libros y préstamos de manera eficiente</p>
            <a href="/prestamos" class="btn btn-outline-primary btn-sm" sec:authorize="hasAuthority('ROLE_ADMIN')">Crear nuevo préstamo</a>
            <a href="/prestamos" class="btn btn-outline-secondary btn-sm" sec:authorize="hasAuthority('ROLE_CLIENTE')">Ver mis préstamos</a>
        </div>
    </section>

    <section class="py-5">
        <div class="container">
            <div class="row text-center">
                <div class="col-lg-4 mb-4" sec:authorize="hasAuthority('ROLE_ADMIN')">
                    <div class="card h-100 border-0 shadow">
                        <div class="card-body">
                            <h5 class="card-title">Gestión de Usuarios</h5>
                            <p class="card-text">Administra usuarios, consulta sus préstamos activos y días restantes de devolución.</p>
                            <a href="/usuarios" class="btn btn-primary">Gestionar Usuarios</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="card h-100 border-0 shadow">
                        <div class="card-body">
                            <h5 class="card-title">Catálogo de Libros</h5>
                            <p class="card-text">Gestiona el inventario de libros, verifica disponibilidad y controla préstamos.</p>
                            <a href="/libros" class="btn btn-primary">Ver Catálogo</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="card h-100 border-0 shadow">
                        <div class="card-body">
                            <h5 class="card-title">Control de Préstamos</h5>
                            <p class="card-text" sec:authorize="hasAuthority('ROLE_ADMIN')">Registra nuevos préstamos y gestiona devoluciones de manera sencilla.</p>
                            <p class="card-text" sec:authorize="hasAuthority('ROLE_CLIENTE')">Consulta tus préstamos activos y fechas de devolución.</p>
                            <a href="/prestamos" class="btn btn-primary">Gestionar Préstamos</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="py-5 bg-light">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-3 mb-3"><div class="card"><div class="card-body"><h3 class="text-primary" id="totalUsuarios">-</h3><p class="mb-0">Total Usuarios</p></div></div></div>
                <div class="col-md-3 mb-3"><div class="card"><div class="card-body"><h3 class="text-success" id="totalLibros">-</h3><p class="mb-0">Total Libros</p></div></div></div>
                <div class="col-md-3 mb-3"><div class="card"><div class="card-body"><h3 class="text-warning" id="librosDisponibles">-</h3><p class="mb-0">Libros Disponibles</p></div></div></div>
                <div class="col-md-3 mb-3"><div class="card"><div class="card-body"><h3 class="text-danger" id="prestamosActivos">-</h3><p class="mb-0">Préstamos Activos</p></div></div></div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const $ = id => document.getElementById(id);
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const [u, l, d, p] = await Promise.all([fetch('/api/usuarios'), fetch('/api/libros'), fetch('/api/libros/disponibles'), fetch('/api/libros/prestados')]);
                const [usuarios, libros, disponibles, prestados] = await Promise.all([u.json(), l.json(), d.json(), p.json()]);
                $('totalUsuarios').textContent = usuarios.length;
                $('totalLibros').textContent = libros.length;
                $('librosDisponibles').textContent = disponibles.length;
                $('prestamosActivos').textContent = prestados.length;
            } catch (error) { console.error('Error al cargar estadísticas:', error); }
        });
    </script>
</body>
</html>